<!DOCTYPE html>
<html>
	<head>
		<title>Diffie-Hellman MITM Attack Simulator</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 0;
				padding: 20px;
				background-color: #18181b;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				background-color: white;
				padding: 20px;
				border-radius: 10px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			}

			.grid {
				display: grid;
				grid-template-columns: repeat(3, 1fr);
				gap: 20px;
				margin-top: 20px;
			}

			.box {
				border: 2px solid #a855f7;
				padding: 15px;
				border-radius: 5px;
				background-color: #f8f9fa;
			}

			.input-group {
				margin: 10px 0;
			}

			input {
				padding: 5px;
				width: 100px;
				margin: 5px;
			}

			button {
				background-color: #a855f7;
				color: white;
				border: none;
				padding: 10px 20px;
				border-radius: 5px;
				cursor: pointer;
				margin: 5px;
			}

			button:hover {
				background-color: #6b21a8;
			}

			.result {
				margin-top: 20px;
				padding: 10px;
				background-color: #e8f4f8;
				border-radius: 5px;
			}

			.value-display {
				margin: 10px 0;
				padding: 8px;
				background-color: #fff;
				border-radius: 4px;
			}

			.animation-container {
				height: 300px;
				position: relative;
				margin: 20px 0;
				border: 1px solid #000000;
				border-radius: 5px;
				background-color: #f8f9fa;
				overflow: hidden;
			}

			.participant {
				position: absolute;
				width: 100px;
				height: 100px;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: bold;
				color: white;
				top: 50px;
			}

			.alice {
				left: 100px;
				background-color: #ff7675;
			}

			.mallory {
				left: 50%;
				transform: translateX(-50%);
				background-color: #55efc4;
				z-index: 2;
			}

			.bob {
				right: 100px;
				background-color: #74b9ff;
			}

			.parameter-display {
				position: absolute;
				width: 150px;
				text-align: center;
				top: 170px;
				font-size: 14px;
				padding: 5px;
				border-radius: 5px;
				background-color: rgba(255, 255, 255, 0.9);
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			}

			.alice-params {
				left: 75px;
				color: #ff7675;
			}

			.mallory-params {
				left: 50%;
				transform: translateX(-50%);
				color: #55efc4;
			}

			.bob-params {
				right: 75px;
				color: #74b9ff;
			}

			.message {
				position: absolute;
				padding: 10px;
				border-radius: 5px;
				font-size: 14px;
				opacity: 0;
				z-index: 1;
				transition: all 0.5s;
			}

			.alice-message {
				background-color: #ff7675;
				color: white;
			}

			.bob-message {
				background-color: #74b9ff;
				color: white;
			}

			.mallory-message {
				background-color: #55efc4;
				color: black;
			}

			@keyframes moveRight {
				0% {
					transform: translateX(0);
					opacity: 1;
				}
				45% {
					opacity: 1;
				}
				50% {
					opacity: 0;
				}
				100% {
					transform: translateX(400px);
					opacity: 0;
				}
			}

			@keyframes moveLeft {
				0% {
					transform: translateX(0);
					opacity: 1;
				}
				45% {
					opacity: 1;
				}
				50% {
					opacity: 0;
				}
				100% {
					transform: translateX(-400px);
					opacity: 0;
				}
			}

			.animate-right {
				animation: moveRight 3s forwards;
			}

			.animate-left {
				animation: moveLeft 3s forwards;
			}

			.path-line {
				position: absolute;
				height: 2px;
				background-color: #ddd;
				top: 100px;
				left: 150px;
				right: 150px;
			}

			.step-display {
				position: absolute;
				bottom: 20px;
				left: 0;
				right: 0;
				text-align: center;
				font-weight: bold;
				color: #2d3436;
				padding: 10px;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>Diffie-Hellman MITM Attack Simulator</h1>

			<div class="input-group">
				<h3>Public Values:</h3>
				<label>Prime (p): <input type="number" id="prime" value="23" /></label>
				<label
					>Primitive Root (g):
					<input type="number" id="primitive_root" value="5"
				/></label>
			</div>

			<div class="grid">
				<div class="box">
					<h3>Alice</h3>
					<div class="input-group">
						<label
							>Private Key (a):
							<input type="number" id="alice-private" value="6"
						/></label>
					</div>
					<div id="alice-public" class="value-display"></div>
					<div id="alice-final" class="value-display"></div>
				</div>

				<div class="box">
					<h3>Mallory (MITM)</h3>
					<div class="input-group">
						<label
							>Private Key (c): <input type="number" id="mallory-c" value="4"
						/></label>
						<label
							>Private Key (d): <input type="number" id="mallory-d" value="7"
						/></label>
					</div>
					<div id="mallory-results" class="value-display"></div>
				</div>

				<div class="box">
					<h3>Bob</h3>
					<div class="input-group">
						<label
							>Private Key (b): <input type="number" id="bob-private" value="8"
						/></label>
					</div>
					<div id="bob-public" class="value-display"></div>
					<div id="bob-final" class="value-display"></div>
				</div>
			</div>

			<div class="animation-container">
				<div class="path-line"></div>
				<div class="participant alice">Alice</div>
				<div class="participant mallory">Mallory</div>
				<div class="participant bob">Bob</div>
				<div class="parameter-display alice-params" id="alice-params">
					Initial: g^a = -
				</div>
				<div class="parameter-display mallory-params" id="mallory-params">
					Intercepted: -
				</div>
				<div class="parameter-display bob-params" id="bob-params">
					Initial: g^b = -
				</div>
				<div class="step-display" id="step-display"></div>
			</div>

			<div style="text-align: center; margin-top: 20px">
				<button onclick="simulate()">Simulate Attack</button>
				<button onclick="reset()">Reset</button>
			</div>

			<div class="result" id="result"></div>
		</div>
		<script>
			function modPow(base, exponent, modulus) {
				if (modulus === 1) return 0;
				let result = 1;
				base = base % modulus;
				while (exponent > 0) {
					if (exponent % 2 === 1) {
						result = (result * base) % modulus;
					}
					base = (base * base) % modulus;
					exponent = Math.floor(exponent / 2);
				}
				return result;
			}

			function createMessage(className, text, startPosition) {
				const msg = document.createElement("div");
				msg.className = `message ${className}`;
				msg.textContent = text;
				msg.style.top = "75px";
				msg.style.left = startPosition + "px";
				return msg;
			}

			function updateStepDisplay(text) {
				document.getElementById("step-display").textContent = text;
			}

			function updateParameters(participant, text) {
				document.getElementById(`${participant}-params`).innerHTML = text;
			}

			function animateExchange(
				alicePublic,
				bobPublic,
				malloryC,
				malloryD,
				malloryAlice,
				malloryBob
			) {
				const container = document.querySelector(".animation-container");

				// Initial values
				updateParameters("alice", `Initial: g^a = ${alicePublic}`);
				updateParameters("bob", `Initial: g^b = ${bobPublic}`);

				// Step 1: Alice to Mallory
				setTimeout(() => {
					updateStepDisplay(
						"Step 1: Alice sends her public value (Intercepted by Mallory)"
					);
					updateParameters(
						"mallory",
						`Intercepted from Alice:<br>g^a = ${alicePublic}`
					);
					const msg = createMessage(
						"alice-message",
						`g^a = ${alicePublic}`,
						150
					);
					container.appendChild(msg);
					msg.classList.add("animate-right");
					setTimeout(() => container.removeChild(msg), 3000);
				}, 0);

				// Step 2: Mallory to Bob
				setTimeout(() => {
					updateStepDisplay("Step 2: Mallory sends modified value to Bob");
					updateParameters("bob", `Received: g^c = ${malloryC}`);
					const msg = createMessage(
						"mallory-message",
						`g^c = ${malloryC}`,
						500
					);
					container.appendChild(msg);
					msg.classList.add("animate-right");
					setTimeout(() => container.removeChild(msg), 3000);
				}, 3000);

				// Step 3: Bob to Mallory
				setTimeout(() => {
					updateStepDisplay(
						"Step 3: Bob sends his public value (Intercepted by Mallory)"
					);
					updateParameters(
						"mallory",
						`Intercepted from Bob:<br>g^b = ${bobPublic}`
					);
					const msg = createMessage("bob-message", `g^b = ${bobPublic}`, 850);
					container.appendChild(msg);
					msg.classList.add("animate-left");
					setTimeout(() => container.removeChild(msg), 3000);
				}, 6000);

				// Step 4: Mallory to Alice
				setTimeout(() => {
					updateStepDisplay("Step 4: Mallory sends modified value to Alice");
					updateParameters("alice", `Received: g^d = ${malloryD}`);
					const msg = createMessage(
						"mallory-message",
						`g^d = ${malloryD}`,
						500
					);
					container.appendChild(msg);
					msg.classList.add("animate-left");
					setTimeout(() => container.removeChild(msg), 3000);
				}, 9000);

				setTimeout(() => {
					updateStepDisplay(
						"Attack Complete! Mallory can now intercept all communications."
					);
					updateParameters("alice", `Final Keys With Alice: ${malloryAlice}`);
					updateParameters("bob", `Final Keys With Bob: ${malloryBob}`);
				}, 12000);

				// Final step
				setTimeout(() => {
					updateStepDisplay(
						"Attack Complete! Mallory can now intercept all communications."
					);
					updateParameters(
						"mallory",
						`Final Keys:<br>With Alice: ${malloryAlice}<br>With Bob: ${malloryBob}`
					);
				}, 12000);
			}

			function simulate() {
				try {
					// Get input values
					const p = parseInt(document.getElementById("prime").value);
					const g = parseInt(document.getElementById("primitive_root").value);
					const a = parseInt(document.getElementById("alice-private").value);
					const b = parseInt(document.getElementById("bob-private").value);
					const c = parseInt(document.getElementById("mallory-c").value);
					const d = parseInt(document.getElementById("mallory-d").value);

					// Validate inputs
					if (!p || !g || !a || !b || !c || !d) {
						alert("Please fill in all values");
						return;
					}

					// Calculate public values
					const alicePublic = modPow(g, a, p);
					const bobPublic = modPow(g, b, p);
					const malloryC = modPow(g, c, p);
					const malloryD = modPow(g, d, p);

					// Calculate final keys
					const aliceFinal = modPow(malloryD, a, p);
					const bobFinal = modPow(malloryC, b, p);
					const malloryAlice = modPow(alicePublic, d, p);
					const malloryBob = modPow(bobPublic, c, p);

					// Start animation
					animateExchange(
						alicePublic,
						bobPublic,
						malloryC,
						malloryD,
						malloryAlice,
						malloryBob
					);

					// Display results
					document.getElementById(
						"alice-public"
					).innerHTML = `<strong>Public Value:</strong><br>g^a mod p = ${alicePublic}`;

					document.getElementById(
						"alice-final"
					).innerHTML = `<strong>Final Key:</strong><br>(g^d)^a mod p = ${aliceFinal}`;

					document.getElementById(
						"bob-public"
					).innerHTML = `<strong>Public Value:</strong><br>g^b mod p = ${bobPublic}`;

					document.getElementById(
						"bob-final"
					).innerHTML = `<strong>Final Key:</strong><br>(g^c)^b mod p = ${bobFinal}`;

					document.getElementById("mallory-results").innerHTML = `
                    <strong>Intercepted Values:</strong><br>
                    From Alice: ${alicePublic}<br>
                    From Bob: ${bobPublic}<br><br>
                    <strong>Generated Values:</strong><br>
                    For Alice (g^d): ${malloryD}<br>
                    For Bob (g^c): ${malloryC}<br><br>
                    <strong>Computed Keys:</strong><br>
                    With Alice: ${malloryAlice}<br>
                    With Bob: ${malloryBob}
                `;

					document.getElementById("result").innerHTML = `
                    <div style="background-color: #ffe8e8; padding: 15px; border-radius: 5px;">
                        <h3>Attack Summary:</h3>
                        <p><strong>Initial Parameters:</strong></p>
                        <ul>
                            <li>Prime (p) = ${p}</li>
                            <li>Primitive Root (g) = ${g}</li>
                        </ul>
                        <p><strong>Private Keys:</strong></p>
                        <ul>
                            <li>Alice's private key (a) = ${a}</li>
                            <li>Bob's private key (b) = ${b}</li>
                            <li>Mallory's private keys: c = ${c}, d = ${d}</li>
                        </ul>
                        <p><strong>Final Keys:</strong></p>
                        <ul>
                            <li>Alice-Mallory shared key: ${aliceFinal}</li>
                            <li>Bob-Mallory shared key: ${bobFinal}</li>
                        </ul>
                        <p style="color: #dc3545; font-weight: bold;">
                            Attack Successful! Mallory can now intercept and decrypt all messages between Alice and Bob.
                        </p>
                    </div>
                `;
				} catch (error) {
					console.error("Error in simulation:", error);
					alert(
						"An error occurred during simulation. Check the console for details."
					);
				}
			}

			function reset() {
				document.getElementById("alice-public").innerHTML = "";
				document.getElementById("alice-final").innerHTML = "";
				document.getElementById("bob-public").innerHTML = "";
				document.getElementById("bob-final").innerHTML = "";
				document.getElementById("mallory-results").innerHTML = "";
				document.getElementById("result").innerHTML = "";
				document.getElementById("step-display").textContent = "";
				updateParameters("alice", "Initial: g^a = -");
				updateParameters("mallory", "Intercepted: -");
				updateParameters("bob", "Initial: g^b = -");
			}
		</script>
	</body>
</html>
